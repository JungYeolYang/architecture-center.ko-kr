---
title: Throttling
description: Control the consumption of resources used by an instance of an application, an individual tenant, or an entire service.
keywords: design pattern
author: dragon119
ms.service: guidance
ms.topic: article
ms.author: pnp
ms.date: 03/24/2017

pnp.series.title: Cloud Design Patterns
pnp.pattern.categories: [availability, performance-scalability]
---

# 제한(Throttling)

[!INCLUDE [header](../_includes/header.md)]

응용 프로그램, 개별 테넌트, 전체 서비스의 인스턴스에 의해 사용된 리소스 소비를 제어합니다. 요구 증가가 리소스에 매우 큰 부담을 줄 때조차도, 시스템이 계속 기능을 수행하고 서비스 수준 약정을 충족할 수 있습니다. 

## 컨텍스트와 문제점

일반적으로 클라우드 응용 프로그램에 대한 부하는 활성 사용자의 수와 이들이 수행하는 활동 유형에 근거한 시간에 따라 다양합니다. 예를 들면, 매월 말 더 많은 사용자들이 업무시간에 활동적이기 쉽고, 시스템이 많은 자원이 필요한 분석을 수행해야 할 수 있습니다. 갑작스럽고 예기치 않은 버스트 동작(bursts in activity)이 벌어질 수도 있습니다. 시스템의 처리 요구사항이 이용 가능한 리소스의 역량을 초과한 경우, 성능 저하가 발생하여 실패할 수도 있습니다. 시스템이 합의된 수준의 서비스를 충족해야 하는 경우, 그런 실패는 받아들일 수 없습니다.

응용 프로그램에 대한 비즈니스 목표에 따라, 클라우드에서 다양한 부하를 처리하는 데 이용할 수 있는 전략이 많이 있습니다. 한 가지 전략은 구축된 리소스를 언제라도 사용자 요구에 맞게 자동 크기 조정을 하는 것입니다. 이 전략은 실행 비용을 최적화하면서 사용자 요구를 일관되게 충족시킬 가능성이 있습니다. 그러나, 자동 크기 조정이 추가 리소스의 구축을 유발할 수 있지만, 이런 구축은 즉각적이지 않습니다. 요구가 빠르게 늘어날 경우, 리소스가 부족해지는 기간이 생길 수 있습니다.

## 솔루션

자동 크기 조정에 대한 대안 전략은 응용 프로그램이 리소스를 제한치까지 사용할 수 있게 허용하고, 이 제한에 도달되면 억제하는 것입니다. 시스템은 사용량이 임계값을 넘으면 사용자들의 요청을 억제할 수 있도록 응용 프로그램이 리소스를 얼마나 사용하는지 모니터해야 합니다. 이 경우 시스템은 계속 기능을 수행하고 서비스 수준 약정을 충족할 수 있을 것입니다. 리소스 사용 모니터에 관한 자세한 정보는, [계측 및 원격 분석 지침](https://msdn.microsoft.com/library/dn589775.aspx)을 참조하세요.

시스템은 다음과 같은 제한 전략을 구현할 수 있습니다:

- 정해진 시간에 초당 n회 이상 이미 시스템 API를 액세스한 개별 사용자의 요청을 거부함. 시스템은 응용 프로그램을 실행하는 테넌트 또는 사용자에 대해서 리소스 사용을 측정해야 합니다. 자세한 정보는, [서비스 측정 지침](https://msdn.microsoft.com/library/dn589796.aspx)을 참조하세요.

- 필수 서비스가 충분한 리소스로 막힘없이 실행될 수 있도록, 비필수로 선택된 서비스의 기능을 사용 불가 또는 저하시킴. 예를 들면, 응용 프로그램이 비디오 출력을 스트리밍 중인 경우, 낮은 해상도로 전환할 수 있습니다.

- 작업의 볼륨을 부드럽게 하기 위해 부하 평준화를 이용함(이 접근 방식의 자세한 내용은 [큐 기반의 부하 평준화 패턴](queue-based-load-leveling.md)을 참조하세요). 다중 테넌트 환경에서, 이 접근 방식은 모든 테넌트의 성능을 저하시킬 것입니다. 시스템이 다양한 SLA의 복합적 테넌트를 지원해야 할 경우, 고가의 테넌트 작업이 즉시 수행될 수 있습니다. 다른 테넌트의 요청이 제지되었다가, 백로그가 덜해지면 처리될 수 있습니다. 이 접근방식을 구현하는 데 [우선순위 큐 패턴][] 이 도움이 될 수 있습니다.

- 우선순위가 낮은 응용 프로그램 또는 테넌트 대신 수행되는 작업을 지연시킴. 이 작업은 시스템이 사용 중이어서 작업이 추후 재시도되어야 함을 테넌트에 알리기 위한 예외 상황에서 중단되거나 제한될 수 있습니다.  

그림은 3개 기능을 이용하는 응용 프로그램에 대한 시간별 리소스 사용(메모리, CPU, 대역, 기타 요소)의 영역 그래프를 보여줍니다.  A 기능은 특정 태스크 세트를 수행하는 구성요소, 복잡한 계산을 수행하는 코드, 메모리 내 캐시 등의 서비스를 제공하는 요소와 같은 기능의 영역입니다. 이 기능들은 A, B, C로 라벨 표시되었습니다.

![Figure 1 - Graph showing resource use against time for applications running on behalf of three users](./_images/throttling-resource-utilization.png)


> 기능에 대한 선 바로 아래 영역은 이 기능을 호출할 때 응용 프로그램에 의해 사용되는 리소스를 나타냅니다. 예를 들면, 기능 A의 선 아래 영역은 기능 A를 이용하는 응용 프로그램에 의해 사용된 리소스를, 기능 A의 선과 기능 B의 선 사이의 영역은 기능 B를 호출하는 응용 프로그램에 의해 사용된 리소스를 나타냅니다. 각 기능의 영역을 집계하면 시스템의 총 리소스 사용이 됩니다.

앞의 그림은 작업을 지연시키는 효과를 설명합니다. 시간 T1 바로 앞에서, 이 기능들을 사용하는 모든 응용 프로그램에 할당된 총 리소스는 임계값(리소스 사용 한계)에 도달합니다. 이 때, 응용 프로그램은 사용 가능한 리소스가 소진될 위험에 처합니다.  이 시스템에서, 기능 B는 기능 A나 기능 C보다 덜 중요하므로, 일시적으로 사용할 수 없고 사용 중이던 리소스가 해제됩니다. 시간 T1과 T2 사이에, 기능 A와 기능 C를 사용하는 응용 프로그램은 정상적으로 계속 실행됩니다. 마침내, 기능 B를 다시 사용할 정도로 용량이 충분해진 시간 T2까지 이 두 기능의 리소스 사용이 줄어듭니다.

자동 크기 조정과 제한 접근 방식이 결합함으로써 응용 프로그램이 계속 반응하고 SLA를 준수하도록 도움을 줄 수 있습니다. 요구가 계속 높을 것으로 예상될 경우, 시스템 규모는 확장하는 반면 제한은 일시적 솔루션을 제공합니다. 이 때, 시스템의 전체 기능이 복원될 수 있습니다.

다음 그림은 시스템에서 실행되는 모든 응용 프로그램에 의한 전체 리소스 사용을 시간별로 나타낸 영역 그래프로서, 제한이 자동 크기 조정과 결합될 수 있는지 보여줍니다.

![Figure 2 - Graph showing the effects of combining throttling with autoscaling](./_images/throttling-autoscaling.png)


시간 T1에, 리소스 사용의 소프트 한도를 지정한 임계값에 도달하였습니다. 이 때, 시스템 확장이 시작될 수 있습니다. 그러나, 새 리소스가 빠르게 이용 가능한 상태가 되지 않을 경우, 기존의 리소스가 소진되고 시스템은 실패할 수 있습니다. 이러한 일이 발생하는 것을 막기 위해, 앞서 설명한 바와 같이 시스템이 일시적으로 제한됩니다. 자동 크기 조정이 완료되고 추가 리소스가 이용 가능해지면 제한이 완화될 수 있습니다.

## 문제점 및 고려사항

이 패턴을 구현하는 방법을 결정할 때 다음 사항을 고려해야 합니다.

- 응용 프로그램 제한과 사용 전략은 전체 시스템 설계에 영향을 주는 아키텍처상의 결정입니다. 일단 시스템이 구현되고 나면 추가가 쉽지 않기 때문에 제한은 응용 프로그램 설계 프로세서에서 일찍 고려되어야 합니다.

- 제한이 신속하게 수행되어야 합니다. 시스템은 활동 증가를 감지하고 그에 따라 반응할 수 있어야 합니다. 시스템은 또한 부하가 덜해지고 나서 원래 상태로 신속히 되돌아갈 수 있어야 합니다. 이를 위해 적절한 성능 데이터가 계속 수집되고 모니터되어야 합니다.

- 서비스가 일시적으로 사용자 요구를 거부해야 할 경우, 서비스는 특정 오류 코트를 반환해서 클라이언트 응용 프로그램이 작업 수행을 거절한 원인이 제한 때문임을 이해하도록 해야 합니다. 클라이언트 응용 프로그램은 요청을 재시도하기 전에 어느 정도 기다릴 수 있습니다.

- 시스템이 자동 크기 조정되는 동안, 제한은 임시 수단으로 사용될 수 있습니다. 경우에 따라, 자동 크기 조정이 실행 비용을 크게 늘릴 수 있기 때문에, 버스트 동작이 갑작스럽고 예상치 않게 길어질 경우, 크기 조정보다는 간단히 제한하는 것이 더 낫습니다.

- 시스템이 자동 크기 조정되는 동안 제한이 임시 수단으로 사용되는 경우, 또 리소스 요구가 매우 빠르게 늘어나는 경우, 시스템이 기능을 계속 수행하지 못할 수 있습니다 - 제한 모드로 운영될 때조차도. 이것이 허용되지 않을 경우, 더 큰 용량을 유지 관리하고 더 적극적인 자동 크기 조정을 구성할 것을 고려해봅니다. 

## 이 패턴을 사용하는 경우

다음의 경우 이 패턴을 사용합니다:

- 시스템이 계속해서 서비스 수준 약정을 충족하는지 확인하기 위해서.

- 단일 테넌트가 응용 프로그램이 제공한 리소스를 독점하지 못하게 하기 위해서.

- 버스트 동작을 처리하기 위해서.

- 기능 유지에 필요한 최대 리소스 수준을 제한하여 시스템의 비용 최적화를 지원하기 위해서.

## 예

마지막 그림은 다중 테넌트 시스템에서 제한이 어떻게 구현될 수 있는지 보여줍니다. 테넌트 조직의 사용자들은 설문조사를 작성하고 제출하는 클라우드 호스트된 응용 프로그램을 액세스합니다. 응용 프로그램은 이 사용자들이 응용 프로그램에 요청을 제출하는 속도를 모니터하는 계측 수단을 포함합니다.

한 테넌트의 사용자들이 모든 사용자이 사용하는 응용 프로그램의 응답과 가용성에 영향을 주는 것을 막기 위해서, 한 테넌트의 사용자들이 제출할 수 있는 초당 요청 횟수가 제한됩니다. 응용 프로그램은 이 제한을 초과하는 요청을 차단합니다.

![Figure 3 - Implementing throttling in a multi-tenant application](./_images/throttling-multi-tenant.png)


## 관련 패턴 및 지침

이 패턴을 구현할 때 다음 패턴과 지침 또한 관련될 수 있습니다:
- [•	게측 및 원격 분석 지침](https://msdn.microsoft.com/library/dn589775.aspx). 제한은 서비스가 얼마나 많이 사용되고 있는지에 대한 정보의 수집에 의존합니다. 사용자 지정 모니터링 정보를 생성하고 수집하는 방법에 대해 설명합니다.
- [•	서비스 측정 지침](https://msdn.microsoft.com/library/dn589796.aspx). 서비스가 어떻게 사용되는지에 대한 이해를 얻기 위해서 서비스 사용을 계측하는 방법에 대해 설명합니다. 이 정보는 서비스를 어떻게 억제할지에 대한 방법을 결정할 때 유용할 수 있습니다.
- [•	자동 크기 조정 지침](https://msdn.microsoft.com/library/dn589774.aspx). 제한은 시스템이 자동 크기 조절되는 동안 또는 시스템이 자동 크기 조절될 필요를 제거하기 위해서 임시 조치로 사용될 수 있습니다. 자동 크기 조절 전략에 관한 정보를 포함합니다.
- [•	큐 기반 로드 부하 평준화 패턴](queue-based-load-leveling.md). 큐 기반 부하 평준화는 제한 구현에 일반적으로 사용되는 메커니즘입니다. 큐는 응용 프로그램이 전송한 요청이 서비스로 전달되는 속도를 균등하게 하는 것을 도와주는 버퍼로 작용할 수 있습니다.
- [•	우선순위 큐 패턴][]. 시스템은 덜 중요한 응용 프로그램의 성능은 낮추는 반면 중요하거나 고가의 응용 프로그램의 성능을 유지하기 위해서 제한 전략의 하나로서 우선순위 큐를 사용할 수 있습니다. 

[Priority Queue pattern]: priority-queue.md
