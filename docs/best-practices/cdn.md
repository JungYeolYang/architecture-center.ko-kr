---
title: Content Delivery Network guidance
description: Guidance on Content Delivery Network (CDN) to deliver high bandwidth content hosted in Azure.
author: dragon119
ms.service: guidance
ms.topic: article
ms.date: 09/30/2016
ms.author: pnp

pnp.series.title: Best Practices
---
# 콘텐츠 제공 네트워크(CDN)
[!INCLUDE [header](../_includes/header.md)]

Microsoft Azure 콘텐츠 제공 네트워크(CDN)는 Azure나 다른 모든 위치에서 호스팅되는 고대역폭 콘텐츠를 제공하는 개발자용 전 세계 솔루션입니다. CDN을 사용해 Azure blob 저장소, 웹 응용 프로그램, 가상 컴퓨터, 응용 프로그램 폴더, 여타 HTTP/HTTPS 위치에서 로드되는 공개 개체를 캐시할 수 있습니다. CDN 캐시는 전략적 위치에 고정되어 사용자에게 콘텐츠를 제공하는 대역폭을 극대화할 수 있습니다. CDN은 보통 이미지, 스타일 시트, 문서, 파일, 클라이언트 측 스크립트, HTML 페이지와 같은 정적 콘텐츠를 제공하는 데 사용됩니다. 

또한, 특정 입력을 기반으로 한 PDF 보고서나 그래프와 같은 동적 콘텐츠를 제공하는 캐시로서 CDN을 사용할 수도 있습니다. 

CDN 사용에 따른 주요 이점은 응용 프로그램이 호스팅되는 데이터 센터와 관련하여 낮은 대기 시간과 지리적 위치에 상관 없이 사용자에게 콘텐츠를 빠르게 제공하는 것입니다.  

![CDN diagram](./images/cdn/CDN.png)

CDN을 사용하면 콘텐츠 액세스 및 제공에 필요한 처리 작업이 필요 없어 응용 프로그램에 적용되는 부하를 줄일 수 있습니다. 이러한 부하 감소 덕분에 응용 프로그램의 성능과 확장성이 높아지는 것은 물론, 특정 수준의 성능과 확장성을 확보하는 데 필요한 처리 리소스를 줄여 호스팅 비용을 최소화합니다. 

## HCDN 사용 방법 및 사용 이유
CDN의 일반적인 용도는 다음과 같습니다.    

* (흔히 웹사이트에서) 클라이언트 응용 프로그램용 정적 리소스 제공. 이 리소스로는 이미지, 스타일 시트, 문서, 파일, 클라이언트 측 스크립트, HTML 조각 등 서버가 각 요청별로 수정하지 않아도 되는 콘텐츠가 있습니다. 이 응용 프로그램은 런타임에서 항목을 만들고 CDN(예: 최신 뉴스 헤드라인 목록 생성)에서 사용할 수 있지만, 각 요청별로 항목을 만들지 않습니다.
* 휴대전화와 태블릿 컴퓨터와 같은 장치에 공개 정적 콘텐츠와 공유 콘텐츠를 제공. 이 응용 프로그램은 그 자체로 다양한 장치에서 실행되는 클라이언트에 API를 제공하는 웹 서비스입니다. 또한, CDN은 클라이언트 UI를 생성하는 경우와 같이 클라이언트가 사용할 수 있도록 정적 데이터 집합(웹 서비스를 통해)을 제공할 수 있습니다. 예를 들어, CDN을 사용해 JSON 또는 XML 문서를 배포할 수 있습니다.
* 전용 계산 리소스 없이 공개 정적 콘텐츠만으로 구성된 전체 웹사이트를 제공.
* 동영상 파일을 요청 시 클라이언트에게 스트리밍. 동영상의 장점은 CDN 연결을 지원하는 전 세계 데이터 센터를 통한 안정적인 연결과 짧은 대기 시간입니다.
* 일반적으로 응용 프로그램을 호스팅하는 데이터 센터에서 먼 곳에 있는 사용자의 경험도 개선됩니다. 따라서 이들 사용자는 이전과 달리 긴 대기 시간에 시달리지 않아도 됩니다. 웹 응용 프로그램에서 전체 콘텐츠 대다수는 흔히 정적이므로, CDN을 사용하면 성능과 전체 사용자 경험을 유지하는 동시에 응용 프로그램을 여러 데이터 센터에 배포하는 데 따른 요구사항이 없어집니다.
* 솔루션의 IoT(사물인터넷)를 지원하는 응용 프로그램에서 계속 커지는 부하 처리. 직접 브로드캐스트 메시지를 처리하고 각 장치의 펌웨어 업데이트를 관리해야 하는 경우 관련 장치와 어플라이언스 대다수가 응용 프로그램을 쉽게 통제할 수 있습니다.
* 수요 피크와 급증 시에도 응용 프로그램 크기를 조정하지 않고도 잘 처리하여 운영 비용을 증가시키지 않습니다. 예를 들어, 특정 라우터 모델과 같은 하드웨어 장치나 스마트 TV와 같은 소비재 장치의 운영 체제 업데이트를 릴리스하면, 수백 만 명의 사용자와 장치가 단기간에 다운로드하면서 수요가 갑자기 급증하게 됩니다.

다음 목록은 다양한 지리적 위치에서 첫 바이트의 중위 시간을 보여주는 예입니다. 대상 웹 역할은 Azure West US에 배포됩니다. CDN를 통한 부스트 개선과 CDN 노드 근접성 사이에는 긴밀한 상관 관계가 있습니다. Azure CDN 노드 위치의 전체 목록을 보려면 [Azure 콘텐츠 제공 네트워크(CDN) 노드 위치](/azure/cdn/cdn-pop-locations/)를 확인하십시오. 

|  | 첫 번째 바이트(원본) 시간(ms) | 첫 번째(CDN) 시간(ms) | %CDN 시간 개선 |
| --- | --- | --- | --- |
| \*캘리포니아 주 샌프란시스코 |47.5 |46.5 |2 % |
| \*\*버지니아 주 덜레스 |109 |40.5 |169% |
| 아르헨티나 부에노스아이레스 |210 |151 |39% |
| \*영국 런던 |195 |44 |343% |
| 중국 상해 |242 |206 |17% |
| \*싱가포르 |214 |74 |189 % |
| \*일본 도쿄 |163 |48 |204 % |
| 대한민국 서울 |190 |190 |0% |

\* 동일한 도시에서 Azure CDN 사용.
\*\* 이웃 도시에서 Azure CDN 노드 사용.  

## 과제
CDN 사용을 계획할 때 고려해야 하는 과제는 다음과 같습니다.    

* **구축**. CDN이 콘텐츠를 가져올 원본과 저장소 시스템 2대 이상에 콘텐츠를 배포해야 할지 여부(CDN와 대체 위치 등)를 결정해야 합니다

  응용 프로그램 배포 메커니즘에는 정적 콘텐츠와 리소스 배포뿐 아니라 ASPX 페이지와 같은 응용 프로그램 파일 배포 프로세스를 고려해야 합니다. 예를 들어, Azure blob 저장소로 콘텐츠를 로드하는 별도의 단계를 구현해야 합니다.
* **버전 관리 및 캐시 제어**. 정적 콘텐츠를 업데이트하고 새 버전을 배포하는 방법을 고려해야 합니다. 새 버전이 나오면 CDN 콘텐츠는 Azure Portal을 이용해 CDN 콘텐츠를 [제거](/azure/cdn/cdn-purge-endpoint/)할 수 있습니다. 이것은 웹 브라우저에서 발생하는 문제와 같이 클라이언트 측 캐싱을 관리하는 데 따른 과제와 유사합니다.
* **테스팅**. 응용 프로그램을 로컬이나 스테이징 환경에서 개발하고 테스트할 때에는 CDN 설정을 로컬로 테스트하기 어려울 수도 있습니다.
* **검색 엔진 최적화(SEO)**. CDN을 사용할 때 이미지 및 문서와 같은 콘텐츠는 다른 도메인에서 지원됩니다. 이것은 이 콘텐츠의 SEO에 영향을 줄 수 있습니다.
* **콘텐츠 보안**. Azure CDN과 같은 많은 CDN 서비스는 현재 모든 유형의 액세스 제어 기능을 제공하지 않습니다.
* **클라이언트 보안**. CDN에 있는 리소스에 액세스할 수 없는 환경에서 클라이언트를 연결할 수 있습니다. 이것은 알려진 원본 집합으로 액세스를 제한하는 보안 제한적인 환경이거나 페이지 원본 외에는 어느 곳에서도 리소스를 로드하지 못하도록 하는 환경입니다. 이 사례를 처리하려면 대체 구현이 필요합니다.
* **탄력성**. CDN은 응용 프로그램의 단일 장애 지점입니다. 여기에는 blob 저장소보다 가용성이 낮은 SLA(콘텐츠를 직접 제공하는 데 사용 가능)가 있어서 중요한 콘텐츠의 대체 메커니즘을 구현하는 것이 좋습니다.

  Azure Portal에서 CDN 콘텐츠 가용성, 대역폭, 전송된 데이터, 조회수, 캐시 히트율, 캐시 메트릭을 [실시간](/azure/cdn/cdn-real-time-stats/)으로 [집계 보고서](/azure/cdn/cdn-analyze-usage-patterns/)에서 모니터링할 수 있습니다.

CDN의 유용성이 저하될 수 있는 시나리오:  

* 콘텐츠 히트율이 낮을 경우, 콘텐츠가 유효한 동안 매우 적게 액세스될 수 있습니다(TTL[time-to-live] 설정을 통해 결정). 처음 항목을 다운로드하면, 원본에서 CDN으로, 그리고 CDN에서 고객으로 트랜잭션 요금이 두 번 발생합니다.
* 대기업이나 공급망 에코시스템과 같이 데이터가 비공개인 경우.

## 일반 가이드라인 및 모범 사례
CDN을 사용하면 응용 프로그램의 부하를 효과적으로 최소화하고 가용성과 성능을 극대화할 수 있습니다. 응용 프로그램이 사용하는 적절한 콘텐츠와 리소스 모두에 이 전략을 도입하도록 해야 합니다. CDN 사용 전략을 기획할 때에는 다음 섹션에 나온 주요 사항을 명심해야 합니다.   

### 원본
CDN을 통해 콘텐츠를 간단히 배포하려면 CDN 서비스가 콘텐츠를 액세스하고 캐시하는 데 사용할 HTTP 및 HTTPS 엔드포인트를 지정해야 합니다. 

엔드포인트는 CDN 통해 제공할 정적 콘텐츠를 보관하는 Azure blob 저장소 컨테이너를 지정할 수 있습니다. 컨테이너는 공개로 표시되어야 합니다. 공용 읽기 권한을 갖는 공용 컨테이너의 blob만을 CDN을 통해 사용할 수 있습니다. 

엔드포인트는 애플리케이션의 계산 계층(웹 역할이나 가상 컴퓨터) 응용 프로그램의 **cdn** 이라는 폴더를 지정할 수 있습니다. ASPX 페이지와 같은 동적 리소스를 포함한 리소스 요청의 결과가 CDN에서 캐시됩니다. 최소 캐시 기간은 300초입니다. 이보다 짧은 기간을 설정하면 콘텐츠가 CDN에 배포되지 않습니다(자세한 내용은 아래 제목 *캐시 제어* 참조).

Azure Web App을 사용할 경우 CDN 인스턴스를 만들 때 사이트를 선택하면 엔드포인트가 사이트의 루트 폴더로 설정됩니다. 사이트의 모든 콘텐츠를 CDN을 통해 사용할 수 있습니다. 

대다수의 경우에 애플리케이션의 계산 계층 하나에 있는 폴더의 CDN 엔드포인트를 가리키면 유연성과 제어력이 강화됩니다. 예를 들어, 현재 및 향후 라우팅 요구사항 관리가 쉬워질 뿐 아니라, 이미지 축소판과 같은 정적 콘텐츠를 동적으로 더욱 쉽게 생성할 수 있습니다. 

ASPX 페이지와 같이 콘텐츠를 동적 소스에서 제공할 때 [쿼리 문자열](/azure/cdn/cdn-query-string/)을 사용해 캐시의 개체를 차별화할 수 있습니다. 그렇지만, 이 동작은 CDN 엔드포인트를 지정할 때 Azure Portal의 설정을 통해 비활성화할 수 있습니다. blob 저장소에서 콘텐츠를 제공할 때 쿼리 문자열을 문자열 리터럴로 처리하지만 이름이 동일하지만 쿼리 문자열이 다른 항목 2개는 CDN에서 별도의 항목으로 저장됩니다. 

스크립트 및 다른 콘텐츠와 같은 리소스의 URL 재작성을 활용하여 파일이 CDN 원본 폴더로 이동하지 못하도록 할 수 있습니다. 

Azure 저장소 blob을 사용해 CDN 콘텐츠를 보관하면, blob에 있는 리소스의 URL에서 컨테이너와 blob 이름은 대소문자를 구분합니다. 

사용자 지정 원본이나 Azure Web App을 사용할 때에는 리소스 링크에서 CDN 인스턴스 경로를 지정합니다. 예를 들어, 다음은 CDN을 통해 제공되는 사이트의 **Images** 폴더에 있는 이미지 파일을 지정합니다. 

```XML
<img src="http://[your-cdn-endpoint].azureedge.net/Images/image.jpg" />
```

### 배포
응용 프로그램 배포 패키지나 프로세스에 정적 콘텐츠를 포함하지 않을 경우 응용 프로그램과 무관하게 이 정적 콘텐츠를 프로비저닝하고 배포해야 할 수도 있습니다. 이것은 응용 프로그램 구성 요소와 정적 리소스 콘텐츠를 모두 관리하는 데 사용하는 버전 관리 방식에 미치는 영향을 고려해야 합니다. 

또한, 스크립트와 CSS 파일에서 번들링(여러 파일의 하나의 파일로 결합)과 축소(공백, 새 줄 문자, 의견, 기타 문자와 같은 불필요한 문자 제거) 처리 방법을 고려해야 합니다. 이것은 일반적으로 클라이언트의 부하 시간을 줄일 때 일반적으로 사용되는 기법으로, CDN을 통해 콘텐츠와 호환됩니다. 자세한 내용은 [번들링 및 축소](http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification)를 참조하십시오. 

추가 위치에 콘텐츠를 배포해야 하는 경우, 이 항목은 배포 프로세스에서 추가 단계가 됩니다. 응용 프로그램이 CDN용 콘텐츠를 업데이트하는 경우, 정기적으로나 이벤트에 대응하여 추가 위치뿐 아니라 CDN의 엔드포인트에 업데이트된 콘텐츠를 저장해야 합니다. 

Visual Studio에서는 로컬 Azure 에뮬레이터의 응용 프로그램에 적합한 CDN 엔드포인트를 설정할 수 없습니다. 이 제한은 단위 테스트, 기능 테스트, 최종 배포 전 테스트에 영향을 줍니다. 대체 메커니즘을 구현하여 이 사항을 고려해야 합니다. 예를 들어, 사용자 지정 응용 프로그램이나 유틸리티를 사용하여 콘텐츠를 CDN에 사전 배포하고, 캐시되는 기간에 테스트를 실시할 수 있습니다. 그렇지 않으면, 응용 프로그램이 리소스를 로드하는 위치에서 제어할 지시문이나 전역 상수를 컴파일합니다. 예를 들어, 디버그 모드에서 실행할 때 클라이언트 측 스크립트 번들과 로컬 폴더의 다른 콘텐츠와 같은 리소스를 로드하고, 릴리스 모드에서 실행할 때에는 CDN을 사용합니다. 

CDN이 지원하는 압축 방식을 고려합니다. 

* 원본 서버에서 [압축을 사용](/azure/cdn/cdn-improve-performance/)할 수 있고, 이 경우에 CDN은 기본적으로 압축을 지원하고 압축된 콘텐츠를 zip 또는 gzip과 같은 형식으로 클라이언트에 제공합니다. 응용 프로그램 폴더를 CDN 엔드포인트로서 사용하면 웹 브라우저 또는 다른 유형의 클라이언트로 직접 전달할 때와 동일한 방식으로 서버가 일부 콘텐츠를 자동으로 압축할 수 있습니다. 이 형식은 클라이언트가 보낸 요청에서 **Accept-Encoding** 헤더의 값에 따라 달라집니다. Azure에서 기본 메커니즘은 CPU 사용률이 50% 미만일 때 콘텐츠를 자동으로 압축하는 것입니다. 클라우드 서비스를 사용해 응용 프로그램을 호스팅하는 경우, 설정을 변경하려면 시작 작업을 사용하여 IIS에서 동적 출력 압축을 켜야 할 수도 있습니다. 자세한 내용은 [웹 역할을 통해 Microsoft Azure CDN으로 gzip 압축 사용](http://blogs.msdn.com/b/avkashchauhan/archive/2012/03/05/enableing-gzip-compression-with-windows-azure-cdn-through-web-role.aspx)을 참조하십시오.
* CDN 에지 서버에서 직접 압축을 사용할 수 있고, 이 경우에 CDN은 파일을 압축하여 최종 사용자에게 서비스를 제공합니다. 자세한 내용은 [Azure CDN 압축](/azure/cdn/cdn-improve-performance/)을 참조하십시오.

### 라우팅 및 버전 관리
여러 시간에 CDN 인스턴스를 사용해야 할 수도 있습니다. 예를 들어, 새 응용 프로그램 버전을 배포하고 나서 새 CDN을 사용하면서도 이전 버전을 위해 기존 CDN을 유지(이전 형식으로 콘텐츠 유지)해야 할 수도 있습니다. Azure blob 저장소를 콘텐츠 원본으로 사용할 경우, 간단히 별도의 저장소 계정이나 별도의 컨테이너를 만들고 CDN 엔드포인트를 이것으로 지시할 수 있습니다. 응용 프로그램에 있는 *cdn* 루트 폴더를 CDN 엔드포인트로 사용할 경우 URL 재작성 기법을 사용하여 요청을 다른 폴더로 전달할 수 있습니다. 

Azure blob 저장소에서 콘텐츠를 검색할 때 쿼리 문자열은 리소스 이름(blob 이름)의 일부이기 때문에 쿼리 문자열을 사용하여 CDN의 리소스 링크에서 다른 응용 프로그램 버전을 표시하지 마십시오. 또한 이 접근 방식은 클라이언트가 리소스를 캐시하는 방법에도 영향을 줄 수 있습니다. 

응용 프로그램을 업데이트할 때 이전 리소스를 CDN에 캐시하는 경우 새 정적 콘텐츠 버전을 배포하는 작업은 어려울 수 있습니다. 자세한 내용은 *캐시 제어* 섹션을 참조하십시오.

국가별 CDN 콘텐츠 액세스 제한을 고려해야 합니다. Azure CDN을 사용하여 원본 국가를 기준으로 요청을 필터링하고 제공되는 콘텐츠를 제한할 수 있습니다. 자세한 내용은 [국가별 콘텐츠 액세스 제한](/azure/cdn/cdn-restrict-access-by-country/)을 참조하십시오. 

### 캐시 제어
시스템에서 캐싱 관리 방법을 고려해야 합니다. 예를 들어, 폴더를 CDN 원본으로 사용할 때에는 콘텐츠를 생성하는 페이지의 캐시 기능과 특정 폴더에 있는 모든 리소스의 콘텐츠 만료 시간을 지정할 수 있습니다. 또한 표준 HTTP 헤더를 사용하여 CDN과 클라이언트의 캐시 속성을 지정할 수도 있습니다. 서버와 클라이언트에서 이미 캐싱을 관리해야 하더라도 CDN을 사용하여 콘텐츠가 캐시되는 방법과 그 위치를 보다 잘 알 수 있습니다. 

개체를 CDN에서 사용할 수 없도록 하기 위해 원본(blob 컨테이너 또는 응용 프로그램 *cdn* 루트 폴더)에서 개체를 삭제하거나, CDN 엔드포인트를 제거 또는 삭제하거나 컨테이너 또는 blob을 비공개로 설정할 수 있습니다. 그렇지만, 항목은 TTL(time-to-live)이 만료될 때에만 CDN에서 제거됩니다. 캐시 만료 기간(콘텐츠가 blob 저장소에서 로드되는 시간 등)이 지정되지 않은 경우, 이것은 최대7일 동안 CDN에서 캐시됩니다. 또한 [CDN 엔드포인트를 수동으로 제거](/azure/cdn/cdn-purge-endpoint/)할 수도 있습니다. 

웹 응용 프로그램에서 모든 콘텐츠의 캐싱과 만료를 설정하려면 web.config 파일의 *system.webServer/staticContent* 섹션에서 *clientCache* 요소를 설정할 수 있습니다. web.config 파일을 폴더에 배치할 때에는 이 폴더와 모든 하위 폴더에 영향을 줍니다. 

(응용 프로그램 코드 등에서) CDN용 콘텐츠를 동적으로 만들 경우 각 페이지에서 *Cache.SetExpires* 속성을 반드시 지정해야 합니다. CDN은 *public* 의 기본 캐시 기능 설정을 사용하는 페이지에서 출력을 캐시하지 않습니다. 캐시 만료 기간을 적절한 값으로 설정하여 매우 짧은 간격으로 콘텐츠를 버리고 응용 프로그램에서 다시 로드하지 않도록 해야 합니다.  

### 보안
CDN은 CDN이 제공하는 인증서를 사용하여 HTTPS(SSL)를 통해 콘텐츠를 제공할 수 있지만, HTTP를 통해서도 사용할 수도 있습니다. CDN에서 항목에 대한 HTTP 액세스를 차단할 수 없습니다. HTTPS를 사용하여 HTTPS(쇼핑 카트 등)를 통해 로드된 페이지에 표시되는 정적 콘텐츠를 요청하여 혼합 콘텐츠에 대한 브라우저 경고를 방지할 수 있습니다. 

Azure CDN은 콘텐츠에 대한 보안 액세스를 위한 액세스 제어를 어느 시설에도 제공하지 않습니다. CDN을 통해 공유 액세스 서명(SAS)을 사용할 수 없습니다. 

CDN을 사용해 클라이언트 측 스크립트를 제공할 경우, 이 스크립트가 *XMLHttpRequest* 호출을 사용하여 다른 도메인에서 데이터, 이미지, 글꼴과 같은 리소스에 대한 HTTP 요청을 합니다. 웹 서버가 적절한 응답 헤더를 설정하도록 구성되지 않은 경우 많은 웹 브라우저는 원본 간 리소스 공유(CORS)를 차단합니다. CORS을 지원하도록 다음과 같이 CDN을 구성할 수 있습니다. 

* 콘텐츠를 제공하고 있는 원본이 Azure blob 저장소인 경우, 서비스 속성에 *CorsRule* 을 추가할 수 있습니다. 규칙은 CORS 요청에서 허용된 원본, GET와 같이 허용된 방법, 규칙에서 초 단위의 최대 기간(원본 콘텐츠 로드 후 클라이언트가 연결된 리소스를 요청해야 하는 기간)을 지정할 수 있습니다. 자세한 내용은 [Azure 저장소 서비스에서 원본 간 리소스 공유(CORS) 지원](http://msdn.microsoft.com/library/azure/dn535601.aspx)을 참조하십시오.
* 콘텐츠를 제공하고 있는 원본이 *cdn* 루트 폴더와 같이 응용 프로그램에 있는 폴더인 경우, 모든 응답에서 응용 프로그램 구성 파일에서 아웃바운드 규칙을 구성하여 *Access-Control-Allow-Origin* 헤더를 설정할 수 있습니다. 재작성 규칙에 대한 자세한 내용은 [URL 재작성 모듈](http://www.iis.net/learn/extensions/url-rewrite-module)을 참조하십시오.

### 사용자 지정 도메인
Azure CDN을 통해 [사용자 지정 도메인 이름](/azure/cdn/cdn-map-content-to-custom-domain/)을 지정하고 이것을 사용하여 CDN을 통해 리소스에 액세스할 수 있습니다. 또한 DNS에서 *CNAME* 레코드를 사용하여 사용자 지정 하위 도메인 이름을 설정할 수 있습니다. 이 방법을 of 추상과 제어의 추가 계층을 제공할 수 있습니다. 

*CNAME*를 사용할 경우, CDN은 자체 단일 SSL 인증서를 사용하고 이 인증서가 사용자 지정 도메인/하위 도메인 이름과 일치하지 않습니다. 

### CDN 대체
응용 프로그램이 CDN의 오류나 임시 비가용성을 처리하는 방법을 마련해야 합니다. 클라이언트 응용 프로그램은 이전 요청 중에 로컬에서 캐시되는 리소스의 복사본을 사용하거나 오류를 감지하고 CDN을 사용할 수 없는 경우 대신 원본(리소스를 보관하는 응용 프로그램 폴더 또는 Azure blob 컨테이너)에서 리소스를 요청하는 코드를 포함시킬 수 있습니다. 

### 검색 엔진 최적화
응용 프로그램에서 SEO가 중요한 고려사항인 경우, 다음 작업을 실시해야 합니다. 

* 각 페이지 또는 리소스에서 *Rel* 정식 헤더를 포함합니다.
* *CNAME* 하위 도메인 레코드를 사용하고 이 이름을 사용하여 리소스에 액세스합니다.
* CDN의 IP 주소가 응용 프로그램 자체와 다른 국가나 지역일 수 있다는 사실의 영향을 고려해야 합니다.
* Azure blob 저장소를 원본으로 사용할 때에는 응용 프로그램 폴더에서와 마찬가지로 CDN에서 리소스에 대해 동일한 파일 구조를 유지해야 합니다.

### 모니터링 및 로깅
CDN을 응용 프로그램 모니터링 전략의 일부로서 포함하여 오류 또는 연장 대기 시간 발생을 감지하고 평가합니다. 모니터링 기능은 Azure 포털 사이트에 있는 CDN 프로필 관리자에서 사용할 수 있습니다. 

CDN에서 로깅을 활성화하고 이 로그를 일일 운영의 일부로서 로깅을 사용하고 이 로그를 일일 운영의 일부로서 모니터링합니다. 

사용 패턴에서 CDN 트래픽을 분석하는 것이 좋습니다. Azure 포털에는 모니터링 가능한 도구가 있습니다. 

* 대역폭,
* 전송된 데이터,
* 조회수(상태 코드)
* 캐시 상태,
* 캐시 히트율
* IPV4/IPV6 요청 비율.

자세한 내용은 [CDN 사용 패턴 분석](/azure/cdn/cdn-analyze-usage-patterns/)을 참조하십시오. 

### 비용 영향
CDN의 아웃바운드 데이터 전송 비용이 청구됩니다. 또한, blob 저장소를 사용해 자산을 호스팅하는 경우, CDN이 응용 프로그램에서 데이터를 로드하면 저장소 트랜잭션 비용이 청구됩니다. 콘텐츠에 대한 실제적인 캐시 만료 기간을 설정하여 새로 고침을 실행해야 하지만, 이 기간이 응용 프로그램이나 blob 저장소의 콘텐츠를 CDN에 반복적으로 다시 로드할 정도로 짧아서는 안 됩니다. 

자주 다운로드하지 않는 항목은 서버 부하를 크게 감소시키지 않으면서 트랜잭션 비용을 2회 청구합니다. 

### 번들링 및 축소
번들링 및 축소 기능을 사용하면 CDN에 저장되는 JavaScript 코드와 HTML 페이지와 같은 리소스 크기를 줄입니다. 이 전략은 이 항목을 클라이언트에 다운로드하는 데 소요되는 시간을 줄여줍니다. 

번들링 및 축소는 ASP.NET에서 처리할 수 있습니다. MVC 프로젝트에서 *BundleConfig.cs* 번들을 정의합니다. 보통 보기 클래스의 코드에서 *Script.Render* 메서드를 호출하여 축소된 스크립트 번들을 참조합니다. 이 참조에는 번들 콘텐츠를 기반으로 한 해시를 포함하는 쿼리 문자열이 포함되어 있습니다. 번틀 콘텐츠가 변경되면, 생성된 해시도 변경됩니다.    

기본적으로 Azure CDN 인스턴스에서 *Query String Status* 설정은 비활성화되어 있습니다. 업데이트된 스크립트 번들을 CDN이 올바르게 처리하려면, CDN 인스턴스에서 *Query String Status* 설정을 활성화해야 합니다. 설정이 적용되기까지 1시간 이상이 소요될 수 있습니다. 

## 예제 코드
이 섹션에는 CDN에서 사용하는 코드와 기법 예제가 수록되어 있습니다.  

### URL 재작성
Cloud Services가 호스팅하는 응용 프로그램의 루트에서 Web.config 파일의 다음 발췌 내용은 CDN을 사용할 때 [URL 재작성](https://technet.microsoft.com/library/ee215194.aspx) 방법을 잘 보여줍니다. 캐시되는 콘텐츠의 CDN에서 온 요청은 리소스 유형(스크립트 및 이미지)을 기준으로 응용 프로그램 루트에 있는 특정 폴더로 리디렉션됩니다.    

```XML
<system.webServer>
  ...
  <rewrite>
    <rules>
      <rule name="VersionedResource" stopProcessing="false">
        <match url="(.*)_v(.*)\.(.*)" ignoreCase="true" />
        <action type="Rewrite" url="{R:1}.{R:3}" appendQueryString="true" />
      </rule>
      <rule name="CdnImages" stopProcessing="true">
        <match url="cdn/Images/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Images/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnContent" stopProcessing="true">
        <match url="cdn/Content/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Content/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnScript" stopProcessing="true">
        <match url="cdn/Scripts/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/Scripts/{R:1}" appendQueryString="true" />
      </rule>
      <rule name="CdnScriptBundles" stopProcessing="true">
        <match url="cdn/bundles/(.*)" ignoreCase="true" />
        <action type="Rewrite" url="/bundles/{R:1}" appendQueryString="true" />
      </rule>
    </rules>
  </rewrite>
  ...
</system.webServer>
```

이 재작성 규칙은 다음 리디섹션을 실행합니다. 

* 첫 번째 규칙을 통해 리소스의 파일 이름으로 버전을 포함할 수 있으며, 그리고 나면 이 버전은 무시됩니다. 그 예로는 *Filename_v123.jpg *is rewritten as *Filename.jpg* 가 있습니다.
* 다음 4개 규칙은 웹 역할 루트에 있는 *cdn** 라는 폴더에서 리소스를 저장하지 않을 경우 요청을 리디렉셔하는 방법입니다. 이 규칙은 웹 역할의 각 루트 폴더에 *cdn/Images*, *cdn/Content*, *cdn/Scripts*, *cdn/bundles* URL을 매핑합니다.

URL 재작성을 사용하려면 리소스 번들링을 일부 변경해야 합니다.     

## 자세한 정보
* [Azure CDN](https://azure.microsoft.com/services/cdn/)
* [Azure 콘텐츠 제공 네트워크(CDN) 설명서](https://azure.microsoft.com/documentation/services/cdn/)
* [Azure CDN 사용](/azure/cdn/cdn-create-new-endpoint/)
* [클라우드 서비스와 Azure CDN 통합](/azure/cdn/cdn-cloud-service-with-cdn/)
* [Microsoft Azure 콘텐츠 제공 네트워크(CDN) 모범 사례](https://azure.microsoft.com/blog/2011/03/18/best-practices-for-the-windows-azure-content-delivery-network/)
