---
title: High availability for Azure applications
description: Technical overview and in-depth information about designing and building applications for high availability on Microsoft Azure.
author: adamglick
ms.service: guidance
ms.topic: article
ms.date: 08/18/2016
ms.author: pnp

---
[!INCLUDE [header](../_includes/header.md)]
# Microsoft Azure에 구축된 응용 프로그램의 고가용성
가용성이 높은 응용 프로그램은 종속 서비스 및 하드웨어의 가용성과 부하 변동 및 일시적 장애를 흡수합니다. 그리고 응용 프로그램이 비즈니스 요구 사항 또는 응용 프로그램 서비스 수준 계약서(SLA)의 정의에 따라 수용 가능한 사용자 및 시스템 응답 수준에서 계속 작동합니다.

## Azure 고가용성 특징
Azure는 고가용성 응용 프로그램을 지원하는 많은 내장된 플랫폼 기능을 가지고 있습니다. 이 섹션에서는 그 주요 기능의 일부를 설명합니다. 

### 패브릭 컨트롤러
Azure 패브릭 컨트롤러는 Azure Compute 인스턴스의 상태를 프로비전하고 모니터링합니다. 패브릭 컨트롤러는 호스트 및 게스트 컴퓨터 인스턴스의 하드웨어 및 소프트웨어 상태를 확인합니다. 장애를 감지하면 VM 인스턴스를 자동으로 다시 배치하여 SLA를 적용합니다. 장애 도메인과 업그레이드 도메인 개념이 컴퓨팅 SLA에 대한 지원을 강화합니다.

여러 클라우드 서비스 역할 인스턴스가 배포되어 있을 경우, Azure는 그러한 인스턴스들을 다른 장애 도메인에 배포합니다. 장애 도메인 경계는 기본적으로 동일 지역 내의 다른 하드웨어 랙입니다. 장애 도메인은 국부적인 하드웨어 장애가 응용 프로그램의 서비스를 중단시킬 가능성을 줄여줍니다. 여러분은 작업자 또는 웹 역할에 할당되는 장애 도메인의 수를 관리할 수는 없습니다. 패브릭 컨트롤러는 Azure 호스팅 응용 프로그램과는 분리된 전용 리소스를 사용합니다. 이는 Azure 시스템의 핵심 역할을 수행하기 때문에 100% 가동 시간을 갖습니다. 그리고 장애 도메인 전체에 걸쳐 역할 인스턴스들을 모니터링하고 관리합니다.

아래 다이어그램은 패브릭 컨트롤러가 다른 장애 도메인에 걸쳐 배포하여 관리하는 Azure 공유 리소스를 보여주고 있습니다.

![Simplified view of fault domain isolation](./images/high-availability-azure-applications/fault-domain-isolation.png)

업그레이드 도메인의 기능은 장애 도메인과 유사하지만 장애가 아닌 업그레이드를 지원합니다. 업그레이드 도메인은 인스턴스 분리를 위한 논리 단위로서 한 시점에 특정 서비스의 어떤 인스턴스를 업그레이드할 것인지를 결정합니다. 기본적으로 호스팅된 서비스 배포에는 다섯 개의 업그레이드 도메인이 정의됩니다. 하지만 서비스 정의 파일에서 그 값을 변경할 수 있습니다. 예를 들어 여덟 개의 웹 역할 인스턴스가 있다고 가정하겠습니다. 세 개의 업그레이드 도메인에 두 개의 인스턴스가 있고, 하나의 업그레이드 도메인에 두 개의 인스턴스가 있습니다. Azure가 업데이트 시퀀스를 정의하지만, 이는 업그레이드 도메인 수를 기준으로 합니다. 업그레이드 도메인에 관한 자세한 내용은 [클라우드 서비스 업데이트](/azure/cloud-services/cloud-services-update-azure-service/)를 참조하십시오.

### 다른 서비스의 특징
높은 계산 가용성을 지원하는 플랫폼 기능 외에도 Azure는 다른 서비스에도 고가용성 기능을 포함시킵니다. 예를 들어 Azure Storage는 모든 Blob, 표, 큐 데이터에 대해 세 개의 복제본을 유지합니다. 또한 Blob와 표의 백업을 보조 지역에 저장하기 위해 지리적 복제 옵션을 허용합니다. Azure 콘텐츠 배달 네트워크는 중복성과 확장성을 지원하기 위해 Blob가 전 세계에서 캐시되도록 합니다. 또한 Azure SQL Database는 여러 복제본을 유지합니다.

일련의 [복원 기술 지침](https://aka.ms/bctechguide) 문서 외에도 [Azure 클라우드 서비스에서 대규모 서비스 설계를 위한 모범 사례](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/) 문서도 참조하십시오. 이들 문서는 Azure 플랫폼 가용성 기능을 보다 심층적으로 설명합니다.

Azure가 고가용성을 지원하는 다수의 기능을 제공하지만 그들의 한계를 이해하는 것이 중요합니다.

* Compute의 경우, Azure는 역할이 가용 상태를 유지하고 실행되도록 보장하지만, 응용 프로그램이 실행 중인지 또는 과부하가 걸렸는지는 모릅니다.
* Azure SQL Database의 경우, 데이터가 지역 내에서 동기적으로 복제됩니다. 활성 지리적 복제를 선택할 수 있으며, 이는 동일 지역(또는 다른 지역)에서 최대 네 개의 추가 데이터베이스 복사본을 지원합니다. 이러한 데이터베이스 복제본은 특정 시점의 백업이 아닙니다. SQL 데이터베이스는 지정 시간 백업 기능을 제공하지 않습니다. SQL 데이터베이스의 지정 시간 기능에 관한 자세한 내용은 [Azure SQL Database 지정 시간 복원](https://azure.microsoft.com/blog/azure-sql-database-point-in-time-restore/)을 참조하십시오.
* Azure Storage의 경우 표와 Blob가 기본적으로 대체 지역에 복제됩니다. 하지만 Microsoft가 대체 사이트로 장애 조치 결정을 할 때까지는 복제본에 액세스할 수 없습니다. 지역 장애 조치는 지역 전체의 서비스 중단이 장시간 지속되고 지리적 장애 조치 시간에 대한 SLA가 없을 때에만 발생합니다. 데이터 손상이 복제본에 신속히 확산된다는 것을 인식하는 것도 중요합니다.

이러한 이유 때문에 응용 프로그램별 가용성 기능으로 플랫폼 가용성 기능을 보완해야 합니다. 응용 프로그램별 가용성 기능에는 특정 시점의 Blob 데이터 백업을 만들기 위한 Blob 스냅샷 기능이 포함됩니다.

### Azure 가상 컴퓨터를 위한 가용성 집합
이 문서의 대부분은 서비스형 플랫폼(PaaS) 모델을 사용하는 클라우드 서비스에 초점을 맞추고 있습니다. 하지만 서비스형 인프라(IaaS) 모델을 사용하는 Azure 가상 컴퓨터를 위해 특정한 가용성 기능도 있습니다. 가상 컴퓨터에서 고가용성을 달성하려면 가용성 집합을 사용해야 합니다. 가용성 집합은 장애 도메인 및 업그레이드 도메인에 대해 유사한 기능을 제공합니다. 가용성 집합 내에서 Azure는 로컬 하드웨어 장애 및 유지 관리 활동이 해당 그룹의 모든 컴퓨터를 중지시키는 것을 방지하는 방식으로 가상 컴퓨터를 위치시킵니다. 가상 컴퓨터의 가용성 확보를 위해 Azure SLA를 달성하려면 가용성 집합이 필요합니다.

아래 다이어그램은 웹 및 SQL Server 가상 컴퓨터를 각각 그룹화하는 두 개의 가용성 집합을 표시하고 있습니다.

![Availability sets for Azure Virtual Machines](./images/high-availability-azure-applications/availability-set-for-azure-virtual-machines.png)

> [!참고]
> 위의 다이어그램에서 SQL Server는 가상 컴퓨터에 설치되어 실행되고 있습니다. 이는 앞서 관리 서비스로서 데이터베이스를 제공하는 Azure SQL Database에 대한 설명과는 다른 것입니다.
> 
> 

## 응용 프로그램 고가용성 전략
대부분의 응용 프로그램 고가용성 전략에는 응용 프로그램 구성 요소 간의 중복성 확보 또는 하드웨어 종속성 제거가 포함됩니다. 응용 프로그램 디자인이 Azure 서비스나 타사 서비스의 산발적 가동 중지 동안에 내결함성을 지원해야 합니다. 아래 섹션에서는 클라우드 서비스의 가용성 향상을 위한 응용 프로그램 패턴에 대하여 설명합니다.

### 비동기 통신 및 지속형 큐
Azure 응용 프로그램의 가용성 향상을 위해 느슨하게 결합된 서비스 간의 비동기 통신을 고려해보십시오. 이 패턴에서는 나중에 처리하기 위해 메시지를 저장소 큐 또는 Azure Service Bus 큐에 기록합니다. 메시지를 큐에 기록하면 컨트롤이 즉시 메시지 전송자에게 반환됩니다. 또 하나의 응용 프로그램 계층이 메시지 처리를 담당하며, 일반적으로 작업자 역할로 구현됩니다. 작업자 역할이 다운되면, 처리 서비스가 복원될 때까지 메시지가 큐에 누적됩니다. 큐를 사용할 수 있는 동안은 프런트 엔드 발신자와 메시지 프로세서 간에 직접적인 종속성은 없습니다. 따라서 분산형 응용 프로그램에서 처리량 병목이 될 수 있는 동기 서비스 호출 요구가 없어집니다.

이에 대한 변형에서는 실패한 데이터베이스 호출에 대한 장애 조치 위치로서 Azure Storage (Blob, 표, 큐) 또는 Service Bus 큐를 사용합니다. 예를 들어 응용 프로그램 내에서 다른 서비스(예: Azure SQL Database)에 대한 동기 호출이 반복적으로 실패합니다. 그러면 그 데이터를 지속형 저장소에 직렬화할 수 있습니다. 나중에 서비스나 데이터베이스가 다시 온라인 상태가 되면 응용 프로그램이 저장소로부터 그 요청을 다시 전송할 수 있습니다. 이 모델의 차이점은 중간 위치가 응용 프로그램 워크플로의 상시 부분이 아니라는 것입니다. 장애 시나리오에서만 사용됩니다.

두 시나리오에서 비동기 통신과 증간 저장소는 다운된 백엔드 서비스가 전체 응용 프로그램을 중단시키는 것을 방지합니다. 큐는 논리적 중간 역할을 수행합니다. 올바른 큐 서비스 선택에 관한 자세한 지침은 [Azure 큐 및 Service Bus 큐--비교 및 대비](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)를 참조하십시오.

### 장애 감지 및 재시도 논리
가용성이 높은 응용 프로그램 디자인의 요점은 일시적으로 다운된 서비스를 원활히 처리하기 위해 코드 내에 재시도 논리를 사용하는 것입니다. Microsoft Patterns and Practices 팀이 개발한 [일시적 장애 처리 응용 프로그램 블록](https://msdn.microsoft.com/library/hh680934.aspx)은 응용 프로그램 개발자들에게 그 프로세스를 지원합니다. "일시적"(transient)이란 의미는 비교적 짧은 시간 동안만 지속하는 임시 상태를 의미합니다. 이 문서의 맥락에서 일시적 장애 처리는 고가용성 응용 프로그램 개발의 일부입니다. 일시적 상태의 예를 들면 간헐적인 네트워크 오류 및 데이터베이스 연결 끊김 등이 포함됩니다.

일시적 장애 처리 응용 프로그램 블록은 코드 내에서 원활하게 장애를 처리하는 간편한 방법을 말합니다. 이를 사용하여 강력한 일시적 장애 처리 논리를 추가함으로써 응용 프로그램의 가용성을 향상할 수 있습니다. 대부분의 경우 재시도 논리는 짧은 중단을 처리하고, 한 번 이상의 시도 실패 후에 발신자와 수신자를 연결합니다. 성공적인 재시도 노력은 일반적으로 응용 프로그램 사용자가 알아차리지 못합니다.

개발자들에게는 재시도 논리를 관리하는 세 가지 옵션 즉 증분(incremental), 고정 간격(fixed interval), 지수(exponential) 옵션이 있습니다. 증분 옵션은 선형 증가 방식(예: 1, 2, 3, 4초)으로 기다렸다가 재시도를 수행합니다.  고정 간격 옵션은 각 재시도 간에 동일한 시간(예: 2초)을 기다립니다. 보다 임의적인 옵션으로서 지수 백오프는 재시도 사이에 더 길게 기다립니다. 하지만 지수 방식(예: 2, 4, 8, 16초)을 사용합니다.

코드 내에서의 개괄적 전략은 다음과 같습니다.

1. 재시도 전략과 정책을 정의합니다.
2. 일시적 장애로 이어질 수 있는 작업을 시도합니다.
3. 일시적 장애가 발생하면 재시도 정책을 호출합니다.
4. 모든 재시도가 실패하면 최종 예외로 처리합니다.

시뮬레이션된 장애에서 재시도 논리를 시도하여 연속 작업에서의 재시도로 인하여 예상치 못한 장시간 지연이 발생하지 않도록 하십시오. 전체 작업의 실패 처리를 결정하기 전에 이를 수행하십시오.

### 고가용성을 위한 참조 데이터 패턴
참조 데이터는 응용 프로그램의 읽기 전용 데이터입니다. 이 데이터는 비즈니스 요구 사항을 제시하며 그 범위 내에서 응용 프로그램이 비즈니스 운영 과정에서 트랜잭션 데이터를 생성합니다. 트랜잭션 데이터는 참조 데이터의 지정 시간 기능입니다. 그러므로 참조 데이터의 무결성은 트랜잭션 시점의 참조 데이터 스냅샷에 달려있습니다. 이는 약간 느슨한 정의이지만 여기서의 목적상 충분한 것입니다.

응용 프로그램 맥락에서 참조 데이터는 응용 프로그램의 기능 발휘를 위해 필요한 것입니다. 개별 응용 프로그램이 참조 데이터를 만들어 유지하며, 마스터 데이터 관리(MDM) 시스템이 이 기능을 수행하는 경우도 있습니다. 이들 시스템이 참조 데이터의 수명 주기를 관리합니다. 참조 데이터의 예를 들면 제품 카탈로그, 직원 마스터, 부품 마스터, 장비 마스터 등이 있습니다. 또한 참조 데이터의 출처가 조직 외부가 될 수도 있습니다 (예: 우편번호, 세율). 참조 데이터의 가용성을 높이는 전략은 일반적으로 트랜잭션 데이터보다 어렵지 않습니다. 참조 데이터는 대부분 수정 불가능하다는 이점이 있습니다.

여러분은 참조 데이터를 응용 프로그램과 함께 배포함으로써 런타임 시에 참조 데이터를 자율적으로 소비하는 Azure 웹 및 작업자 역할을 만들 수 있습니다. 로컬 저장소 크기가 그러한 배포를 허용할 경우에는 그것이 이상적인 상태입니다. 포함된 데이터베이스(SQL, NoSQL) 또는 로컬 파일 시스템에 배포된 XML 파일은 Azure 컴퓨팅 확장 단위의 자율성에 도움을 줄 것입니다. 하지만 재배포 없이 각 역할의 데이터를 업데이트하는 메커니즘을 보유해야 합니다. 이를 위해서 참조 데이터에 대한 모든 업데이트는 클라우드 저장소 끝점(예: Azure Blob 저장소 또는 SQL Database)에 두어야 합니다. 역할을 시작할 때 데이터 업데이트를 계산 노드에 다운로드하는 각 역할에 코드를 추가하십시오. 또는 관리자가 역할 인스턴스에 강제로 다운로드하도록 허용하는 코드를 추가하십시오.

가용성을 높이려면, 저장소가 다운될 경우에 대비하여 역할에도 참조 데이터 집합이 포함되어야 합니다. 그러면 저장소 리소스에서 업데이트를 사용할 수 있을 때까지 역할이 기본적 참조 데이터 세트로 시작할 수 있습니다.

![Application high availability through autonomous compute nodes](./images/high-availability-azure-applications/application-high-availability-through-autonomous-compute-nodes.png)

이 패턴에서 한 가지 고려사항은 역할의 시작 속도 및 배포입니다. 시작할 때 다량의 참조 데이터를 배포하거나 다운로드할 경우, 새로운 배포나 역할 인스턴스를 가동할 때 걸리는 시간이 증가할 수 있습니다. 이는 외부 저장소 서비스에 의존하지 않고 각 역할에서 참조 데이터를 즉시 사용할 수 있게 하는 자율성 확보를 위해 수용 가능한 절충점입니다.

### 고가용성을 위한 트랜잭션 데이터 패턴
트랜잭션 데이터는 응용 프로그램이 비즈니스 맥락에서 생성하는 데이터입니다. 트랜잭션 데이터는 응용 프로그램이 구현하는 비즈니스 프로세스 집합과 그 프로세스를 지원하는 참조 데이터의 조합입니다. 트랜잭션 데이터의 예를 들면 주문서, 사전 배송 알림, 송장, 고객 관계 관리(CRM) 기회 등이 있습니다. 이렇게 생성된 트랜잭션 데이터는 기록 유지 또는 추가적 처리를 위해 외부 시스템으로 공급됩니다.

참조 데이터는 이 데이터를 책임지는 시스템 내에서 변할 수 있다는 점에 유의해야 합니다. 그러므로 구문 의미 체계의 외부 종속성을 최소화하기 위해, 트랜잭션 데이터는 특정 시점의 참조 데이터 컨텍스트를 저장해야 합니다. 예를 들어, 주문을 이행하고 몇 달 후에 카탈로그에서 제품을 제거하는 것을 생각해보십시오. 가장 좋은 방법은 가능한 많은 참조 데이터 컨텍스트를 트랜잭션에 포함시키는 것입니다. 그러면 트랜잭션이 캡처된 후에 참조 데이터가 변경될 경우에도 트랜잭션과 관련된 의미 체계가 보존됩니다.

앞서 언급한 바와 같이, 느슨한 결합 및 비동기 통신을 사용하는 아키텍처는 스스로에게 보다 높은 가용성 수준을 제공합니다. 이는 트랜잭션 데이터의 경우에도 마찬가지이지만, 구현 방법이 더 복잡합니다. 기존의 트랜잭션 개념은 일반적으로 트랜잭션을 보장하기 위해 데이터베이스에 의존합니다. 중간 계층을 도입할 경우, 응용 프로그램 코드가 다양한 계층에서 데이터를 올바로 취급함으로써 충분한 일관성과 내구성을 보장해야 합니다.

아래 시퀀스는 트랜잭션 데이터 캡처를 처리와 분리하는 워크플로를 설명하고 있습니다.

1. 웹 계산 노드:  참조 데이터를 제공합니다.
2. 외부 저장소: 중간 트랜잭션 데이터를 저장합니다.
3. 웹 계산 노드: 최종 사용자 트랜잭션을 완료합니다.
4. 웹 계산 노드: 완료된 트랜잭션 데이터를 참조 데이터 컨텍스트와 함께 예측 가능한 응답을 보장하는 임시 지속형 저장소로 전송합니다.
5. 웹 계산 노드: 최종 사용자에게 트랜잭션 완료 신호를 보냅니다.
6. 백그라운드 계산 노드: 트랜잭션 데이터를 추출하고, 필요 시 후처리를 수행하고, 현재 시스템의 최종 저장소 위치로 전송합니다.

아래 다이어그램은 Azure 호스팅 클라우드 서비스에서 가능한 이 디자인의 한 가지 구현 방식을 표시하고 있습니다.

![High availability through loose coupling](./images/disaster-recovery-high-availability-azure-applications/application-high-availability-through-loose-coupling.png)

위의 다이어그램에서 파선 화살표는 비동기 처리를 나타냅니다. 프런트 엔드 웹 역할은 이 비동기 처리를 알지 못합니다. 따라서 트랜잭션이 현재 시스템을 참조하여 최종 대상에 저장됩니다. 이 비동기 모델에 수반되는 대기 시간 때문에 트랜잭션 데이터를 즉시 쿼리에 사용할 수 없습니다. 그러므로 즉각적인 UI 요구 사항을 충족하기 위해 각 트랜잭션 데이터 단위를 캐시 또는 사용자 세션에 저장해야 합니다.

웹 역할은 인프라의 나머지 부분에 대비하여 자율성을 갖습니다. 웹 역할의 가용성 프로필은 웹 역할과 Azure 큐의 조합이며, 전체 인프라가 아닙니다. 고가용성 외에 이 접근법은 백엔드 저장소와 관계 없이 웹 역할의 수평적 확장을 허용합니다. 이 고가용성 모델은 운영의 경제성에 영향을 줄 수 있습니다. Azure 큐, 작업자 역할 등 추가적인 구성 요소는 월 사용 비용에 영향을 줄 수 있습니다.

위의 다이어그램은 트랜잭션 데이터에 대한 분리된 접근법의 한 가지 구현 방식을 보여주는 것입니다. 가능한 다른 많은 구현 방식이 있습니다. 아래 목록은 몇 가지 대안을 제시합니다.

* 작업자 역할은 웹 역할과 저장소 큐 사이에 위치할 수 있습니다.
* Azure Storage 큐 대신에 Service Bus를 사용할 수 있습니다.
* 최종 대상은 Azure Storage 또는 다른 데이터베이스 제공자가 될 수 있습니다.
* 트랜잭션 후에 즉시 캐싱 요구 사항을 제공하기 위해 웹 계층에서 Azure 캐시를 사용할 수도 있습니다.

### 확장성 패턴
클라우드 서비스의 확장성은 가용성에 직접적인 영향을 준다는 점을 인식하는 것이 중요합니다. 부하 증가로 서비스가 응답하지 못할 경우, 사용자는 응용 프로그램이 다운되었다는 인상을 받습니다. 예상되는 응용 프로그램 부하 및 향후 기대치를 기준으로 확장성 모범 사례를 따르십시오. 최고의 규모를 위해서는 단일 / 다수 저장소 계정의 사용, 여러 데이터베이스에 걸친 공유, 캐싱 전략 등 많은 고려 사항이 수반됩니다. 이들 패턴을 심층적으로 살펴보려면 [Azure 클라우드 서비스에서 대규모 서비스 설계를 위한 모범 사례](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)를 참조하십시오.

## 파트너가 취해야 할
이 문서는 [Microsoft Azure에 구축된 응용 프로그램의 재해 복구 및 고가용성](disaster-recovery-high-availability-azure-applications.md)에 초점을 맞춘 일련의 기사 중 일부입니다. 이 시리즈의 다음 문서는 [Microsoft Azure에 구축된 응용 프로그램의 재해 복구](disaster-recovery-azure-applications.md)입니다.

