---
title: Recover from loss of an Azure region
description: Article on understanding and designing resilient, highly available, fault tolerant applications as well as planning for disaster recovery
author: adamglick
ms.service: guidance
ms.topic: article
ms.date: 08/18/2016
ms.author: pnp
---
[!INCLUDE [header](../_includes/header.md)]
# Azure 복원 기술 지침: 지역 전체 서비스 중단의 복구
Azure는 물리적, 논리적으로 지역이라고 불리는 단위로 분할됩니다. 지역은 가까이 있는 한 개 이상의 데이터센터로 구성됩니다. 이 글을 쓰는 현재 시점에 Azure는 전 세계에 24개의 지역을 가지고 있습니다.

드문 경우이지만 전체 지역에 있는 시설들이 네트워크 장애 등의 이유로 액세스가 불가능하게 될 가능성이 있습니다. 또는 자연 재해 등의 이유로 시설이 완전히 손실될 수도 있습니다. 이 섹션에서는 여러 지역에 걸쳐 분산된 응용 프로그램을 만드는 Azure 기능에 대하여 설명합니다. 이러한 배포는 한 지역의 장애가 다른 지역들에 영향을 줄 가능성을 최소화하는 데 도움을 줍니다.

## 클라우드 서비스
### 자원 관리
각 목표 지역에 별도의 클라우드 서비스를 만들어 배포 패키지를 각 클라우드 서비스에 게시함으로써 컴퓨팅 인스턴스를 여러 지역에 걸쳐 배포할 수 있습니다. 하지만 트래픽을 다른 지역의 클라우드 서비스에 걸쳐 배포하는 작업은 응용 프로그램 개발자 또는 트래픽 관리 서비스를 통해서 구현해야 합니다.

재해 복구를 위해 사전에 배포할 예비 역할 인스턴스의 수를 결정하는 것이 용량 계획에서 중요한 측면입니다. 완전한 규모의 보조 배포가 있다면 필요 시 용량을 사용할 준비가 된 상태이지만, 비용이 실질적으로 두 배가 됩니다. 일반적 패턴은 중요한 서비스만 실행할 수 있는 크기의 소규모 보조 배포를 보유하는 것입니다. 이 소규모 배포는 용량을 예비로 보유하고 보조 환경의 구성을 테스트하기 위한 좋은 아이디어입니다.

> [!참고]
> 가입 할당량이 용량 보증은 아닙니다. 할당량은 단순히 신용 한도입니다. 용량을 보장하려면 필요한 역할 수가 서비스 모델에 정의되어야 하고, 반드시 역할이 배포되어야 합니다.
> 
> 

### 부하 분산
지역 간에 트래픽을 부하를 분산하려면 트래픽 관리 솔루션이 필요합니다. Azure는 [Azure Traffic Manager](https://azure.microsoft.com/services/traffic-manager/)를 제공합니다. 유사한 트래픽 관리 기능을 제공하는 타사 서비스를 활용할 수도 있습니다.

### 전략
여러 지역에 걸쳐 분산형 컴퓨팅을 구현하는 데에는 많은 대안 전략을 사용할 수 있습니다. 이들은 응용 프로그램의 특정 비즈니스 요구 사항과 상황에 맞게 조정해야 합니다. 개괄적으로 접근법은 다음 범주로 구분할 수 있습니다.

* **재해 시 재배포**: 이 접근법에서는 재해 발생 시 응용 프로그램을 처음부터 재배포합니다. 이는 복구 시간에 대한 보장이 필요 없는 중요하지 않은 응용 프로그램에 적절합니다.
* **웜 스패어 (액티브/패시브)**: 대체 지역에 보조 호스팅된 서비스를 만들고 최소한의 용량 보장을 위해 역할을 배포하지만, 역할들이 프로덕션 트래픽을 받지는 않습니다. 이 접근법은 여러 지역에 트래픽을 분산하도록 설계되지 않은 응용 프로그램에 유용합니다.
* **핫 스패어 (액티브/액티브)**: 이 응용 프로그램은 여러 지역에서 프로덕션 부하를 받도록 설계됩니다. 각 지역의 클라우드 서비스들이 재해 복구 목적에 필요한 것보다 더 많은 용량으로 구성될 수도 있습니다. 또한 재해 발생 및 장애 조치 시에 필요에 따라 클라우드 서비스를 확장할 수도 있습니다. 이 접근법의 경우 응용 프로그램 설계에 상당한 투자가 필요하지만 유의미한 이점이 있습니다. 여기에는 적은 복구 시간이 보장되고, 모든 복구 지역에 대한 연속 테스트 그리고 용량의 효율적 사용 등이 포함됩니다.

분산형 디자인에 대한 전체 설명은 본 문서의 범위를 벗어납니다. 자세한 내용은 [Azure 응용 프로그램의 재해 복구 및 고가용성](https://aka.ms/drtechguide)을 참조하십시오.

## 가상 컴퓨터
서비스형 인프라(IaaS) 가상 컴퓨터(VM)의 복구는 여러 측면에서 서비스형 플랫폼(PaaS) 컴퓨팅 복구와 유사합니다. 하지만 IaaS VM이 VM과 VM 디스크로 구성된다는 사실 때문에 중요한 차이점이 있습니다.

* **응용 프로그램의 일관성을 유지하는 지역간 백업을 만들려면 Azure Backup을 사용하십시오**.
  [Azure Backup](https://azure.microsoft.com/services/backup/)을 통해서 고객들은 여러 VM 디스크 간에 응용 프로그램의 일관성이 유지되는 백업을 생성할 수 있고, 여러 지역에 걸쳐 백업의 복제를 지원할 수 있습니다. 이 작업은 생성 시에 백업 모음의 지리적 복제를 선택하여 수행할 수 있습니다. 백업 모음의 복제는 생성 시에 구성해야 한다는 점에 유의하십시오. 나중에 설정할 수는 없습니다. 지역이 손실될 경우 Microsoft가 고객들에게 백업을 사용할 수 있게 만듭니다. 고객들은 자신들이 구성한 복원 지점으로 복원할 수 있습니다.
* **데이터 디스크를 운영 체제 디스크로부터 분리하십시오**. IaaS VM의 중요한 고려 사항은 VM을 다시 만들지 않고서는 운영 체제 디스크를 변경할 수 없다는 것입니다. 복구 전략이 재해 후에 재배포하는 방식인 경우에는 문제가 되지 않습니다. 하지만 용량 유지를 위해 웜 스패어 접근법을 사용할 경우에는 문제가 될 수 있습니다. 이를 적절히 구현하려면, 올바른 시스템 디스크가 기본 위치와 보조 위치에 모두 배포되어 있어야 하고, 응용 프로그램 데이터가 별도 드라이브에 저장되어 있어야 합니다. 가능하면 양쪽 위치에서 제공할 수 있는 표준 운영 체제 구성을 사용하십시오. 장애 조치 이후에는 데이터 드라이브를 보조 DC의 기존 IaaS VM에 연결해야 합니다. 데이터 디스크의 스냅샷을 원격 사이트에 복사하려면 AzCopy를 사용하십시오.
* **여러 VM 디스크의 지리적 장애 조치 이후에는 예상되는 일관성 문제에 유의하십시오**. VM 디스크는 Azure Storage Blob로 구현되며 동일한 지리적 복제 특성을 갖습니다. [Azure Backup](https://azure.microsoft.com/services/backup/)을 사용하지 않을 경우, 디스크 간 일관성을 보장할 수 없는데 그 이유는 지리적 복제가 비동기 방식이고 독립적으로 복제되기 때문입니다. 개별 VM 디스크는 지리적 장애 조치 후에 손상 방지 상태가 되도록 보장하지만, 디스크 간 일관성은 보장되지 않습니다. 따라서 일부의 경우(예: 디스크 스트라이핑)에 문제가 야기될 수 있습니다.

## 저장소
### 지역 중복 저장소를 사용한 Blob, 표, 큐, VM 디스크 저장소 복구
Azure에서는 기본적으로 Blob, 표, 큐, VM 디스크가 모두 지리적으로 복제됩니다. 이것을 지역 중복 저장소(Geo-Redundant Storage, GRS)라고 합니다. GRS는 저장소 데이터를 특정 지리적 지역 내에서 수백 마일 떨어져 쌍을 이루고 있는 데이터 센터에 복제합니다. GRS는 주요 데이터센터 재해가 발생할 경우 추가적인 내구성을 제공하도록 설계됩니다. 장애 조치 발생 시에 Microsoft가 통제를 하며, 장애 조치는 원래 기본 위치를 합리적 기간 내에 복구할 수 없다고 간주되는 주요 재해에 국한됩니다. 일부 시나리오에서는 복구에 며칠이 소요될 수도 있습니다. 서비스 수준 계약에 동기화 간격이 아직 명시되지 않은 경우에도 데이터는 일반적으로 몇 분 내에 복제됩니다.

지리적 장애 조치의 경우, 계정 액세스 방법에는 변동이 없습니다 (URL과 계정 키는 변경되지 않습니다). 하지만 장애 조치 후에는 저장소 계정이 다른 지역에 있을 것입니다. 이는 저장소 계정에 대한 지역 선호도를 요구하는 응용 프로그램에는 영향을 줄 수 있습니다. 동일한 데이터센터에서 저장소 계정을 요구하지 않는 서비스와 응용 프로그램의 경우에도, 데이터센터간 대기 시간 및 대역폭 비용 때문에 트래픽을 장애 조치 지역으로 일시적으로 전환하는 이유가 될 수 있습니다. 이 내용을 전체적 재해 복구 전략에 반영할 수 있습니다.

GRS가 제공하는 자동 장애 조치 외에도, Azure는 보조 저장소 위치에 있는 데이터 복사본에 대한 읽기 액세스를 지원하는 서비스를 도입하였습니다. 이것을 읽기 액세스 지역 중복 저장소(Read-Access Geo-Redundant Storage, RA-GRS)라고 합니다.

GRS 및 RA-GRS 저장소에 관한 자세한 내용은 [Azure Storage 복제](/azure/storage/storage-redundancy/)를 참조하십시오.

### 지리적 복제 지역 매핑:
저장소에 대한 지역 선호도를 요구하는 데이터의 여타 인스턴스를 어디에 배포할지 알기 위해 데이터가 어디에 지리적으로 복제되는지 파악하는 것이 중요합니다. 자세한 내용은 [Azure 쌍으로 연결된 지역](/azure/best-practices-availability-paired-regions)을 참조하십시오.

### 지리적 복제 가격:
지리적 복제는 Azure Storage의 현재 가격 정책에 포함되어 있습니다. 이것을 지역 중복 저장소(GRS)라고 합니다. 데이터의 지리적 복제를 원하지 않을 경우 계정에서 지리적 복제를 사용하지 않는 것으로 설정할 수 있습니다. 이것을 로컬 중복 저장소(Locally Redundant Storage)라고 하며, 요금은 GRS에 비하여 할인된 가격을 적용합니다.

### 지리적 장애 조치가 발생했는지 확인하는 방법
지리적 장애 조치가 발생하면 그 내용이 [Azure 서비스 상태 대시보드](https://azure.microsoft.com/status/)에 게시됩니다. 하지만 응용 프로그램이 해당 저장소 계정에 대한 지리적 지역을 모니터링함으로써 이를 감지하는 자동화된 수단을 구현할 수 있습니다. 이 방식은 해당 저장소가 전환되는 지리적 지역에 있는 컴퓨팅 자원을 활성화하는 등 다른 복구 작업을 트리거하기 위해 사용될 수 있습니다. 서비스 관리 API에서 [저장소 계정 속성 얻기](https://msdn.microsoft.com/library/ee460802.aspx)를 사용하여 그 내용에 대한 쿼리를 수행할 수 있습니다. 해당 속성은 아래와 같습니다.

    <GeoPrimaryRegion>primary-region</GeoPrimaryRegion>
    <StatusOfPrimary>[Available|Unavailable]</StatusOfPrimary>
    <LastGeoFailoverTime>DateTime</LastGeoFailoverTime>
    <GeoSecondaryRegion>secondary-region</GeoSecondaryRegion>
    <StatusOfSecondary>[Available|Unavailable]</StatusOfSecondary>

### VM 디스크 및 지리적 장애 조치
VM 디스크에 관한 섹션에서 설명했듯이, 장애 조치 후에 VM 디스크 간에 데이터 일관성을 보장되지 않습니다. 백업의 정확성을 보장하려면 Data Protection Manager와 같은 백업 제품을 사용하여 응용 프로그램 데이터를 백업하고 복원해야 합니다.

## 데이터베이스
### SQL 데이터베이스
Azure SQL Database는 두 가지 유형의 복구 즉 지리적 복원 및 활성 지리적 복제를 지원합니다.

#### 지리적 복원
[지리적 복원](/azure/sql-database/sql-database-recovery-using-backups/#geo-restore)은 기본, 표준, 프리미엄 데이터베이스에서도 사용할 수 있습니다. 이는 데이터베이스가 호스팅된 지역의 사고 때문에 데이터베이스를 사용할 수 없을 때 기본 복구 옵션을 제공합니다. 지정 시간 복원과 마찬가지로, 지리적 복원도 지역 중복 Azure 저장소에 있는 데이터베이스 백업에 의존합니다. 즉 지리적으로 복제된 백업 복사본에서 복원하므로 기본 지역의 저장소 중단 시에 복원이 가능합니다. 자세한 내용은 [Azure SQL Database 복원 또는 보조 데이터베이스로 장애 조치](/azure/sql-database/sql-database-disaster-recovery/)를 참조하십시오.

#### 활성 지리적 복제
[활성 지리적 복제](/azure/sql-database/sql-database-geo-replication-overview/)는 모든 데이터베이스 계층에서 사용할 수 있습니다. 이는 지리적 복원보다 더 적극적인 복구 요구 사항이 있는 응용 프로그램을 위해 설계되었습니다. 활성 지리적 복제를 사용하면 다른 지역에 있는 서버들에서 최대 네 개의 읽기 가능 보조 데이터베이스를 만들 수 있습니다. 그러면 임의 보조 데이터베이스로 장애 조치를 취할 수 있습니다. 또한 활성 지리적 복제는 응용 프로그램 업그레이드나 재배치 시나리오, 그리고 읽기 전용 작업 부하의 부하 분산을 지원하기 위해 사용할 수도 있습니다. 자세한 내용은 [지리적 복제 구성](/azure/sql-database/sql-database-geo-replication-portal/) 및 [보조 데이터베이스로 장애 조치](/azure/sql-database/sql-database-geo-replication-failover-portal/)를 참조하십시오. 응용 프로그램 설계 및 구현 방법과 가동 중지 없이 응응 프로그램을 업그레이드하는 방법에 관한 자세한 내용은 [SQL 데이터베이스에서 활성 지리적 복제를 통한 클라우드 재해 복구를 위한 응용 프로그램 설계](/azure/sql-database/sql-database-designing-cloud-solutions-for-disaster-recovery/) 및 [SQL 데이터베이스 활성 지리적 복제를 사용한 클라우드 응용 프로그램의 롤링 업그레이드 관리](/azure/sql-database/sql-database-manage-application-rolling-upgrade/)를 참조하십시오.

### 가상 컴퓨터의 SQL Server
다앙한 옵션을 사용하여 Azure 가상 컴퓨터에서 실행되는 SQL Server 2012(이후 버전)의 복구 및 고가용성 확보가 가능합니다. 자세한 내용은 [Azure 가상 컴퓨터의 SQL Server를 위한 고가용성 및 재해 복구](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)를 참조하십시오.

## 기타 Azure 플랫폼 서비스
여러 Azure 지역에서 클라우드 서비스를 실행할 때, 각 종속성의 영향을 고려해야 합니다. 아래 섹션에서 서비스별 지침은 대체 Azure 데이터센터에서 동일한 Azure 서비스를 사용하는 것을 가정합니다. 여기에는 구성 및 데이터 복제 작업이 포함됩니다.

> [!참고]
> 일부의 경우 이러한 절차가 전체 데이터센터 이벤트보다는 서비스별 중단을 완화하는 데 도움을 줄 수 있습니다. 응용 프로그램의 관점에서는 서비스별 중단이 마찬가지로 제한적일 수 있고, 서비스를 대체 Azure 지역으로 일시적으로 마이그레이션하는 것이 필요할 수 있습니다.
> 
> 

### Service Bus
Azure Service Bus는 Azure 지역들을 포괄하지 않는 고유한 네임스페이스를 사용합니다. 따라서 첫 번째 요구 사항은 대체 지역에 필요한 서비스 버스 네임스페이스를 설정하는 것입니다. 하지만 큐 메시지의 내구성도 고려합니다. Azure 지역들에 걸쳐 메시지를 복제하는 전략은 몇 가지가 있습니다. 이들 복제 전략과 다른 재해 복구 전략에 관한 자세한 내용은 [Service Bus 중단 및 재해로부터 응용 프로그램을 분리하는 모범 사례](/azure/service-bus-messaging/service-bus-outages-disasters/)를 참조하십시오. 기타 가용성 고려사항은 [Service Bus(가용성)](recovery-local-failures.md#other-azure-platform-services)를 참조하십시오.

### 앱 서비스
Azure App Service 응용 프로그램(예: Web Apps 또는 Mobile Apps)을 보조 Azure 지역으로 마이그레이션하려면 게시에 사용할 수 있는 웹사이트 백업을 가지고 있어야 합니다. 중단 대상에 전체 Azure 데이터베이스가 포함되지 않을 경우, FTP를 사용하여 사이트 콘텐츠의 최신 백업을 다운로드할 수 있습니다. 앞서 용량 할당을 위해 만들지 않았을 경우, 대체 지역에 새로운 앱을 만드십시오. 사이트를 새 지역에 게시하고, 필요한 구성 변경 작업을 수행합니다. 이러한 변경 작업에는 데이터베이스 연결 문자열 또는 기타 지역별 설정이 포함될 수 있습니다. 필요 시 사이트의 SSL 인증서를 추가하고 DNS CNAME 레코드를 변경함으로써 사용자 지정 도메인 이름이 재배포된 Azure Web App URL을 가리키도록 하십시오.

### HDInsight
HDInsight와 관련된 데이터는 기본적으로 Azure Blob 저장소에 저장됩니다. HDInsight는 Hadoop 클러스터 처리 MapReduce 작업을 분석 대상 데이터가 포함된 저장소 계정과 동일한 영역에 공동 배치하도록 요구합니다. Azure Storage에 사용할 수 있는 지리적 복제 기능을 이용할 경우, 무슨 이유로든 기본 지역을 더 이상 사용할 수 없을 경우에 데이터가 복제된 보조 지역에 있는 데이터에 액세스할 수 있습니다. 데이터베이스를 복제했던 지역에 새 Hadoop 클러스터를 만들어 계속 처리할 수 있습니다. 기타 가용성 고려사항은 [HDInsight (가용성)](recovery-local-failures.md#other-azure-platform-services)를 참조하십시오.

### SQL 보고
현재는 Azure 지역의 손실로부터 복구하려면 다른 Azure 지역들에 있는 여러 SQL Reporting 인스턴스가 필요합니다. SQL Reporting 인스턴스는 동일한 데이터에 액세스해야 하고, 해당 데이터는 재해 발생 시 자체 복구 계획을 가지고 있어야 합니다. 또한 각 보고서에 대해 RDL 파일의 외부 백업 복사본을 유지할 수도 있습니다. 

### 미디어 서비스
Azure Media Services는 인코딩 및 스트리밍에 대해 다른 복구 접근법을 가지고 있습니다. 일반적으로 스트리밍은 지역 서비스 중단 시에 더욱 중요합니다. 이에 대비하려면 두 개의 다른 Azure 지역에 Media Services 계정을 가지고 있어야 합니다. 인코딩된 콘텐츠는 양쪽 지역에 모두 있어야 합니다. 장애 기간 동안 스트리밍 트래픽을 대체 지역으로 리디렉션할 수 있습니다. 인코딩은 Azure 지역에서 수행할 수 있습니다. 인코딩이 시간에 민감할 경우 (예: 라이브 이벤트 프로세싱) 장애 기간에 작업을 대체 데이터센터로 제출할 준비를 해야 합니다.

### 가상 네트워크
구성 파일은 대체 Azure 지역에 가상 네트워크를 설치하는 가장 빠른 방법을 제공합니다. 기본 Azure 지역에 가상 네트워크를 구성한 후, 현재 네트워크의 [가상 네트워크 설정을 네트워크 구성 파일로 내보내기](/azure/virtual-network/virtual-networks-create-vnet-classic-portal/) 합니다. 기본 지역에 서비스 중단이 발생할 경우 저장된 구성 파일로부터 [가상 네트워크를 복원](/azure/virtual-network/virtual-networks-create-vnet-classic-portal/) 합니다. 그리고 나서, 새로운 가상 네트워크에서 작동할 수 있도록 여타 클라우드 서비스, 가상 컴퓨터 또는 크로스 프레미스 설정을 구성합니다.

## 재해 복구 체크리스트
## 클라우드 서비스 체크리스트
1. 이 문서의 클라우드 서비스 섹션을 검토합니다.
2. 교차 지역 재해 복구 전략을 작성합니다.
3. 대체 지역에 용량을 보유하는 것의 장단점을 이해합니다.
4. Azure Traffic Manager와 같은 트래픽 라우팅 도구를 사용합니다.

## 가상 컴퓨터 체크리스트
1. 이 문서의 가상 컴퓨터 섹션을 검토합니다.
2. [Azure Backup](https://azure.microsoft.com/services/backup/)을 사용하여 지역에 걸쳐 응용 프로그램에 일관된 백업을 생성합니다.

## 저장소 체크리스트
1. 이 문서의 저장소 섹션을 검토합니다.
2. 저장소 리소스의 지리적 복제를 비활성화하지 마십시오.
3. 장애 조치 시에 지리적 복제의 대체 지역에 대하여 이해합니다.
4. 사용자가 제어하는 장애 조치 전략을 위해 사용자 지정 백업 전략을 작성합니다.

## SQL Database 체크리스트
1. 이 문서의 SQL Database 섹션을 검토합니다.
2. 필요 시 [지리적 복원](/azure/sql-database/sql-database-recovery-using-backups/#geo-restore) 또는 [지리적 복제](/azure/sql-database/sql-database-geo-replication-overview/)를 사용합니다.

## 가상 컴퓨터의 SQL Server 체크리스트
1. 이 문서에 있는 가상 컴퓨터의 SQL Server 섹션을 검토합니다.
2. 교차 지역 AlwaysOn 가용성 그룹 또는 데이터베이스 미러링을 사용합니다.
3. 또는 백업을 사용하여 Blob 저장소로 복원합니다.

## Service Bus 체크리스트
1. 이 문서의 Service Bus 섹션을 검토합니다.
2. 대체 지역에 서비스 버스 네임스페이스를 구성합니다.
3. 여러 지역에 걸친 메시지의 사용자 지정 복제 전략을 고려합니다.

## App Service 체크리스트
1. 이 문서의 App Service 섹션을 검토합니다.
2. 기본 지역 밖에 사이트 백업을 유지합니다.
3. 부분적 서비스 중단이 발생할 경우 FTP로 현재 사이트의 검색을 시도합니다.
4. 사이트를 대체 지역의 새 사이트 또는 기존 사이트에 배포할 계획을 수립합니다.
5. 응용 프로그램 및 DNS CNAME 레코드의 구성 변경 계획을 수립합니다.

## HDInsight 체크리스트
1. 이 문서의 HDInsight 섹션을 검토합니다.
2. 복제된 데이터를 사용하여 지역에 새로운 Hadoop 클러스터를 만듭니다.

## SQL Reporting 체크리스트
1. 이 문서의 SQL Reporting 섹션을 검토합니다.
2. 다른 지역에 대체 SQL Reporting 인스턴스를 유지합니다.
3. 대상을 그 지역에 복제할 별도 계획을 유지합니다.

## Media Services 체크리스트
1. 이 문서의 Media Services 섹션을 검토합니다.
2. 대체 지역에 Media Services 계정을 만듭니다.
3. 스트리밍 장애 조치를 지원하기 위해 양쪽 지역에서 동일한 콘텐츠를 인코딩합니다.
4. 서비스 중단 시 인코딩 작업을 대체 지역으로 제출합니다.

## 가상 네트워크 체크리스트
1. 이 문서의 가상 네트워크 섹션을 검토합니다.
2. 내보낸 가상 네트워크 설정을 사용하여 다른 지역에 가상 네트워크를 다시 만듭니다.

